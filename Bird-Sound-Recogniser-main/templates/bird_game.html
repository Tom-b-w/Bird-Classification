<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¸Ÿé¸£è¿çº¿æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: url("{{ url_for('static', filename='images/bg_main.jpg') }}") no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }



        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: transparent;
            overflow: visible;
        }

        .header {
            background: transparent;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 3px 3px 15px rgba(0, 0, 0, 0.8);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
            margin-bottom: 20px;
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            position: relative;
            z-index: 1;
        }

        .score-item {
            background: transparent;
            color: white;
            padding: 12px 25px;
            font-size: 1.1em;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
        }

        .score-item div:first-child {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .game-controls {
            padding: 20px;
            text-align: center;
            background: transparent;
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            background: linear-gradient(135deg, #45a049 0%, #388e3c 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .btn:disabled {
            background: linear-gradient(135deg, #bdbdbd 0%, #9e9e9e 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn.home-btn {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        .btn.home-btn:hover {
            background: linear-gradient(135deg, #F57C00 0%, #E65100 100%);
            box-shadow: 0 8px 25px rgba(255, 152, 0, 0.4);
        }

        .game-area {
            padding: 30px;
            display: none;
        }

        .game-area.active {
            display: block;
        }

        .game-content {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: 30px;
            align-items: start;
        }

        .sounds-section, .birds-section {
            background: transparent;
            padding: 25px;
        }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 25px;
            text-align: center;
            color: white;
            text-shadow: 3px 3px 15px rgba(0, 0, 0, 0.8);
            font-weight: 700;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            border-radius: 2px;
        }

        .sound-item, .bird-item {
            padding: 18px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            border-radius: 15px;
        }

        .sound-item {
            background: rgba(33, 150, 243, 0.15);
            backdrop-filter: blur(8px);
            border: 2px solid #2196F3;
        }

        .bird-item {
            background: rgba(169, 169, 169, 0.2);  /* æµ…ç°è‰²èƒŒæ™¯ï¼Œé€æ˜åº¦ä¸º 0.2 */
            backdrop-filter: blur(8px);  /* ä¿æŒæ¨¡ç³Šæ•ˆæœ */
            border: 2px solid #808080;  /* ç°è‰²è¾¹æ¡† */
        }

        .sound-item::before, .bird-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .sound-item:hover::before, .bird-item:hover::before {
            left: 100%;
        }

        .sound-item:hover, .bird-item:hover {
            transform: translateY(-3px) scale(1.02);
        }

        .sound-item:hover {
            background: rgba(33, 150, 243, 0.25);
            border-color: #1976D2;
        }

        .bird-item:hover {
            background-color: #76c7c0;  /* æ¸©æš–çš„æµ…ç»¿è‰²èƒŒæ™¯ */
            border-color: #808080;  /* æ ‡å‡†ç°è‰²è¾¹æ¡† */
        }


        .sound-item.selected {
            background: rgba(33, 150, 243, 0.4);
            border-color: #0D47A1;
            transform: translateY(-2px) scale(1.03);
        }

        .bird-item.selected {
            background: rgba(76, 175, 80, 0.4);
            border-color: #1B5E20;
            transform: translateY(-2px) scale(1.03);
        }

        .sound-item.matched {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
            opacity: 0.7;
            pointer-events: none;
            transform: scale(0.98);
        }

        .bird-item.matched {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
            opacity: 0.7;
            pointer-events: none;
            transform: scale(0.98);
        }

        .sound-item.wrong {
            background: rgba(244, 67, 54, 0.3);
            border-color: #F44336;
            animation: shake 0.6s ease-in-out;
        }

        .bird-item.wrong {
            background: rgba(244, 67, 54, 0.3);
            border-color: #F44336;
            animation: shake 0.6s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .play-btn {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        .play-btn:hover {
            background: linear-gradient(135deg, #1976D2 0%, #1565C0 100%);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }

        .play-btn:active {
            transform: scale(0.95);
        }

        .bird-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .bird-name {
            font-size: 1.1em;
            font-weight: bold;
            color: white;
            text-align: center;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
        }

        .sound-item div:last-child {
            color: white;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
            font-weight: 600;
            font-size: 1.1em;
        }

        .connection-area {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            padding: 20px;
        }

        .connection-area div {
            font-size: 2.5em;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 2px 15px rgba(0, 0, 0, 0.8);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        .connection-line {
            position: absolute;
            height: 2px;
            background: #4CAF50;
            transform-origin: left center;
            opacity: 0.8;
            z-index: 1;
        }

        .game-result {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-top: 20px;
            display: none;
        }

        .game-result.show {
            display: block;
        }

        .result-title {
            font-size: 2em;
            color: white;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
            margin-bottom: 15px;
        }

        .result-score {
            font-size: 1.5em;
            color: white;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
            margin-bottom: 20px;
        }

        .success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .success-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .success-modal-content {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transform: scale(0.7);
            transition: transform 0.3s ease;
            max-width: 400px;
            margin: 20px;
        }

        .success-modal.show .success-modal-content {
            transform: scale(1);
        }

        .success-modal h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        .success-modal p {
            font-size: 1.3em;
            margin-bottom: 30px;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.3);
        }

        .success-modal .btn {
            margin: 0 10px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: white;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
        }

        .error-message {
            background: rgba(244, 67, 54, 0.2);
            backdrop-filter: blur(8px);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin: 20px;
            text-align: center;
            display: none;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.8);
        }

        .instructions {
            background: white;
            padding: 20px;
            margin: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .instructions h3 {
            color: #2E7D32;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .instructions ul {
            color: #333;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
            font-size: 1em;
        }

        @media (max-width: 768px) {
            .game-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .connection-area {
                display: none;
            }

            .score-board {
                flex-direction: column;
                gap: 10px;
            }

            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¦ é¸Ÿé¸£è¿çº¿æ¸¸æˆ</h1>
            <p>å¬å£°è¯†é¸Ÿï¼Œè¿çº¿åŒ¹é…ï¼</p>
            <div class="score-board">
                <div class="score-item">
                    <div>å¾—åˆ†</div>
                    <div id="score">0</div>
                </div>
                <div class="score-item">
                    <div>å·²åŒ¹é…</div>
                    <div id="matches">0/0</div>
                </div>
            </div>
        </div>

        <div class="instructions">
            <h3>æ¸¸æˆè§„åˆ™ï¼š</h3>
            <ul>
                <li>ç‚¹å‡»å·¦ä¾§çš„æ’­æ”¾æŒ‰é’®å¬é¸Ÿé¸£å£°</li>
                <li>é€‰æ‹©å¯¹åº”çš„é¸Ÿç±»å›¾ç‰‡è¿›è¡Œè¿çº¿</li>
                <li>æ­£ç¡®åŒ¹é…å¾—10åˆ†ï¼Œé”™è¯¯åŒ¹é…æ— å¾—åˆ†</li>
                <li>å®Œæˆæ‰€æœ‰åŒ¹é…å³å¯è¿‡å…³ï¼</li>
            </ul>
        </div>

        <div class="game-controls">
            <button class="btn home-btn" onclick="window.location.href='/welcome'">ğŸ  è¿”å›é¦–é¡µ</button>
            <button class="btn" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
            <button class="btn" id="resetBtn" disabled>é‡æ–°å¼€å§‹</button>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="game-area" id="gameArea">
            <div class="loading" id="loading">æ­£åœ¨åŠ è½½æ¸¸æˆæ•°æ®...</div>

            <div class="game-content" id="gameContent" style="display: none;">
                <div class="sounds-section">
                    <div class="section-title">ğŸ”Š é¸Ÿé¸£å£°éŸ³</div>
                    <div id="soundsList"></div>
                </div>

                <div class="connection-area" id="connectionArea">
                    <div style="font-size: 2em; color: #4CAF50;">â†”</div>
                </div>

                <div class="birds-section">
                    <div class="section-title">ğŸ¦ é¸Ÿç±»å›¾ç‰‡</div>
                    <div id="birdsList"></div>
                </div>
            </div>

            <div class="game-result" id="gameResult">
                <div class="result-title">ğŸ‰ æ­å–œå®Œæˆï¼</div>
                <div class="result-score" id="finalScore"></div>
                <button class="btn" onclick="startNewGame()">å†ç©ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <!-- æˆåŠŸå¼¹çª— -->
    <div class="success-modal" id="successModal">
        <div class="success-modal-content">
            <h2>ğŸ‰ æ­å–œï¼</h2>
            <p>é—¯å…³æˆåŠŸï¼</p>
            <p>æ‚¨æˆåŠŸåŒ¹é…äº†æ‰€æœ‰çš„é¸Ÿé¸£å£°ï¼</p>
            <button class="btn" onclick="closeSuccessModal()">ç»§ç»­</button>
            <button class="btn" onclick="startNewGame(); closeSuccessModal();">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // å®Œæ•´çš„é¸Ÿç±»æ•°æ®
        const BIRD_GAME_DATA = {
            'ç°é›': {
                'description': 'ç°é›æ˜¯ä¸€ç§å¤§å‹æ°´é¸Ÿï¼Œä¸»è¦æ –æ¯åœ¨æ¹¿åœ°å’Œæ¹–æ³Šä¸­ã€‚',
                'image': 'images/gray_geese.png',
                'sound': 'sounds/gray_geese.wav'
            },
            'å¤§å¤©é¹…': {
                'description': 'å¤§å¤©é¹…æ˜¯åŒ—åŠçƒè¾ƒå¤§çš„æ°´é¸Ÿï¼Œä»¥å…¶ä¼˜ç¾çš„å§¿æ€è‘—ç§°ã€‚',
                'image': 'images/swan.png',
                'sound': 'sounds/swan.wav'
            },
            'ç»¿å¤´é¸­': {
                'description': 'ç»¿å¤´é¸­æ˜¯å¸¸è§çš„æ°´é¸Ÿï¼Œé›„æ€§å¤´éƒ¨å‘ˆäº®ç»¿è‰²ï¼Œæ –æ¯åœ¨æ¹–æ³Šå’Œæ¹¿åœ°ã€‚',
                'image': 'images/mallard_duck.png',
                'sound': 'sounds/mallard_duck.wav'
            },
            'ç»¿ç¿…é¸­': {
                'description': 'ç»¿ç¿…é¸­æ˜¯ä¸€ç§æ –æ¯åœ¨æ¹¿åœ°ä¸­çš„å°å‹æ°´é¸Ÿï¼Œé›„æ€§å…·æœ‰ç‹¬ç‰¹çš„ç»¿è‰²ç¿…è†€ã€‚',
                'image': 'images/green_winged_duck.png',
                'sound': 'sounds/green_winged_duck.wav'
            },
            'ç°å±±é¹‘': {
                'description': 'ç°å±±é¹‘æ –æ¯åœ¨å±±åœ°å’Œå¹²è‰åŸï¼Œæ˜¯ä¸€ç§ä½“å‹è¾ƒå°çš„é¸Ÿç±»ã€‚',
                'image': 'images/grey_partridge.png',
                'sound': 'sounds/grey_partridge.wav'
            },
            'è¥¿é¹Œé¹‘': {
                'description': 'è¥¿é¹Œé¹‘æ˜¯ä¸€ç§ä½“å‹å°å·§ã€æ –æ¯åœ¨è‰åœ°å’ŒçŒä¸›ä¸­çš„é¸Ÿç±»ã€‚',
                'image': 'images/western_quail.png',
                'sound': 'sounds/western_quail.wav'
            },
            'é›‰é¸¡': {
                'description': 'é›‰é¸¡æ˜¯å…·æœ‰è‰³ä¸½ç¾½æ¯›çš„é¸Ÿç±»ï¼Œå¸¸è§äºæ£®æ—å’Œè‰åŸä¸­ã€‚',
                'image': 'images/pheasant.png',
                'sound': 'sounds/pheasant.wav'
            },
            'çº¢å–‰æ½œé¸Ÿ': {
                'description': 'çº¢å–‰æ½œé¸Ÿæ –æ¯åœ¨æ¹–æ³Šå’Œæ¹¿åœ°ä¸­ï¼Œå…·æœ‰é²œè‰³çš„çº¢è‰²å–‰éƒ¨ã€‚',
                'image': 'images/red_throated_diver.png',
                'sound': 'sounds/red_throated_diver.wav'
            },
            'è‹é¹­': {
                'description': 'è‹é¹­æ˜¯å¤§å‹æ°´é¸Ÿï¼Œé€šå¸¸æ –æ¯åœ¨æ¹¿åœ°å’Œæ²¼æ³½åœ°å¸¦ï¼Œä»¥é±¼ç±»ä¸ºé£Ÿã€‚',
                'image': 'images/grey_heron.png',
                'sound': 'sounds/grey_heron.wav'
            },
            'æ™®é€šé¸¬é¹š': {
                'description': 'æ™®é€šé¸¬é¹šæ˜¯å¸¸è§çš„æ°´é¸Ÿï¼Œæ –æ¯åœ¨æ¹–æ³Šå’Œæ²³æµä¸­ï¼Œä»¥æ•é±¼ä¸ºä¸»ã€‚',
                'image': 'images/cormorant.png',
                'sound': 'sounds/cormorant.wav'
            },
            'è‹é¹°': {
                'description': 'è‹é¹°æ˜¯ä¸€ç§å¤§å‹çŒ›ç¦½ï¼Œä¸»è¦æ –æ¯åœ¨æ£®æ—å’Œå±±åŒºï¼Œæ•é£Ÿå…¶ä»–å°å‹é¸Ÿç±»ã€‚',
                'image': 'images/eurasian_hawk.png',
                'sound': 'sounds/eurasian_hawk.wav'
            },
            'æ¬§äºšéµŸ': {
                'description': 'æ¬§äºšéµŸæ˜¯ä¸€ç§æ –æ¯åœ¨å¹¿é˜”è‰åŸå’Œæ£®æ—ä¸­çš„çŒ›ç¦½ï¼Œä¸»è¦æ•é£Ÿå°å‹å“ºä¹³åŠ¨ç‰©ã€‚',
                'image': 'images/eurasian_buzzard.png',
                'sound': 'sounds/eurasian_buzzard.wav'
            },
            'è¥¿æ–¹ç§§é¸¡': {
                'description': 'è¥¿æ–¹ç§§é¸¡æ –æ¯åœ¨æ¹¿åœ°å’Œå†œç”°ä¸­ï¼Œä½“å‹è¾ƒå°ï¼ŒåŠ¨ä½œæ•æ·ã€‚',
                'image': 'images/western_rail.png',
                'sound': 'sounds/western_rail.wav'
            },
            'éª¨é¡¶é¸¡': {
                'description': 'éª¨é¡¶é¸¡æ –æ¯åœ¨æ¹¿åœ°å’Œæ°´è‰ä¸°å¯Œçš„åŒºåŸŸï¼Œä»¥æ°´ç”Ÿæ¤ç‰©ä¸ºé£Ÿã€‚',
                'image': 'images/bonecrest_chicken.png',
                'sound': 'sounds/bonecrest_chicken.wav'
            },
            'é»‘ç¿…é•¿è„šé¹¬': {
                'description': 'é»‘ç¿…é•¿è„šé¹¬æ –æ¯åœ¨æ¹¿åœ°åœ°åŒºï¼Œå…·æœ‰è¾ƒé•¿çš„è…¿éƒ¨å’Œé»‘è‰²çš„ç¿…è†€ã€‚',
                'image': 'images/black_winged_stilt.png',
                'sound': 'sounds/black_winged_stilt.wav'
            },
            'å‡¤å¤´éº¦é¸¡': {
                'description': 'å‡¤å¤´éº¦é¸¡æ˜¯ä¸€ç§æ –æ¯åœ¨è‰åœ°å’Œå†œç”°ä¸­çš„é¸Ÿç±»ï¼Œæ‹¥æœ‰æ˜¾è‘—çš„å¤´éƒ¨ç¾½å† ã€‚',
                'image': 'images/crested_lark.png',
                'sound': 'sounds/crested_lark.wav'
            },
            'ç™½è…°è‰é¹¬': {
                'description': 'ç™½è…°è‰é¹¬æ –æ¯åœ¨æ¹¿åœ°å’Œè‰ä¸›ä¸­ï¼Œæ‹¥æœ‰é²œæ˜çš„ç™½è‰²è…°éƒ¨ç¾½æ¯›ã€‚',
                'image': 'images/white_winged_snipe.png',
                'sound': 'sounds/white_winged_snipe.wav'
            },
            'çº¢è„šé¹¬': {
                'description': 'çº¢è„šé¹¬æ˜¯ä¸€ç§ä½“å‹ä¸­ç­‰çš„é¸Ÿç±»ï¼Œæ –æ¯åœ¨æ¹¿åœ°å’Œæ²¼æ³½åœ°å¸¦ï¼Œå¸¸è§äºè¿å¾™æœŸã€‚',
                'image': 'images/red_legged_snipe.png',
                'sound': 'sounds/red_legged_snipe.wav'
            },
            'æ—é¹¬': {
                'description': 'æ—é¹¬æ –æ¯åœ¨æ£®æ—å’Œæ¹¿åœ°ä¸­ï¼Œæ“…é•¿åœ¨æ¹¿åœ°ä¸­è§…é£Ÿã€‚',
                'image': 'images/wood_snipe.png',
                'sound': 'sounds/wood_snipe.wav'
            },
            'éº»é›€': {
                'description': 'éº»é›€æ˜¯ä¸€ç§å°å‹é¸Ÿç±»ï¼Œå¸¸è§äºåŸå¸‚å’Œå†œç”°åœ°åŒºï¼Œæ –æ¯åœ¨å»ºç­‘ç‰©é™„è¿‘ã€‚',
                'image': 'images/sparrow.jpg',
                'sound': 'sounds/sparrow.wav'
            },
            'å…«å“¥': {
                'description': 'å…«å“¥æ˜¯ä¸€ç§èªæ˜çš„é¸£ç¦½ï¼Œæ“…é•¿æ¨¡ä»¿äººç±»è¯­è¨€ï¼Œå¸¸è§äºåŸå¸‚å’Œä¹¡æ‘ã€‚',
                'image': 'images/myna.jpg',
                'sound': 'sounds/myna.wav'
            },
            'çº¢å¤´é•¿å°¾å±±é›€': {
                'description': 'çº¢å¤´é•¿å°¾å±±é›€æ˜¯ä¸€ç§å°å‹é¸Ÿç±»ï¼Œå…·æœ‰é²œè‰³çš„çº¢è‰²å¤´éƒ¨ï¼Œæ´»è·ƒäºæ£®æ—å’ŒçŒæœ¨ä¸›ã€‚',
                'image': 'images/red_headed_tit.jpg',
                'sound': 'sounds/red_headed_tit.wav'
            },
            'æ£•å¤´é¸¦é›€': {
                'description': 'æ£•å¤´é¸¦é›€æ˜¯ä¸€ç§ä½“å‹å°å·§çš„é¸Ÿç±»ï¼Œä¸»è¦åˆ†å¸ƒåœ¨æ£®æ—å’ŒçŒæœ¨ä¸›ä¸­ã€‚',
                'image': 'images/brown_parrotbill.jpg',
                'sound': 'sounds/brown_parrotbill.wav'
            },
            'é»„è…¹æŸ³èº': {
                'description': 'é»„è…¹æŸ³èºæ˜¯ä¸€ç§å°å‹é¸£ç¦½ï¼Œæ –æ¯åœ¨æ£®æ—å’ŒçŒæœ¨ä¸›ä¸­ï¼Œä»¥æ˜†è™«ä¸ºé£Ÿã€‚',
                'image': 'images/yellow_bellied_warbler.jpg',
                'sound': 'sounds/yellow_bellied_warbler.wav'
            },
            'è¤å¤´é¹ªèº': {
                'description': 'è¤å¤´é¹ªèºæ˜¯ä¸€ç§æ´»è·ƒçš„é¸£ç¦½ï¼Œä»¥æ˜†è™«ä¸ºé£Ÿï¼Œä¸»è¦æ –æ¯åœ¨çŒæœ¨ä¸›å’Œè‰åœ°ã€‚',
                'image': 'images/brown_warbler.jpg',
                'sound': 'sounds/brown_warbler.wav'
            },
            'ç™½é¢Šå™ªé¹': {
                'description': 'ç™½é¢Šå™ªé¹æ˜¯ä¸€ç§ç”Ÿæ´»åœ¨æ£®æ—ä¸­çš„é¸Ÿç±»ï¼Œä»¥æœå®å’Œæ˜†è™«ä¸ºé£Ÿï¼Œå«å£°å“äº®ã€‚',
                'image': 'images/noisy_pitta.jpg',
                'sound': 'sounds/noisy_pitta.wav'
            },
            'ç™½å¤´é¹': {
                'description': 'ç™½å¤´é¹æ˜¯ä¸€ç§å¸¸è§çš„é¸£ç¦½ï¼Œå–œæ¬¢ç¾¤å±…ï¼Œä¸»è¦åˆ†å¸ƒåœ¨åŸå¸‚å’Œå†œç”°é™„è¿‘ã€‚',
                'image': 'images/light_vented_bulbul.jpg',
                'sound': 'sounds/light_vented_bulbul.wav'
            },
            'çŸ¶é¹¬': {
                'description': 'çŸ¶é¹¬æ˜¯ä¸€ç§å°å‹æ¶‰ç¦½ï¼Œæ –æ¯åœ¨æ²¿æµ·å’Œæ·¡æ°´æ¹¿åœ°ï¼Œä»¥å°å‹æ°´ç”ŸåŠ¨ç‰©ä¸ºé£Ÿã€‚',
                'image': 'images/sandpiper.jpg',
                'sound': 'sounds/sandpiper.wav'
            },
            'æˆ´èƒœ': {
                'description': 'æˆ´èƒœæ˜¯ä¸€ç§ç¾ä¸½çš„é¸Ÿç±»ï¼Œå¤´é¡¶æœ‰é†’ç›®çš„ç¾½å† ï¼Œä¸»è¦ä»¥æ˜†è™«ä¸ºé£Ÿã€‚',
                'image': 'images/hoopoe.jpg',
                'sound': 'sounds/hoopoe.wav'
            },
            'å°ç™½é¹­': {
                'description': 'å°ç™½é¹­æ˜¯ä¸€ç§å¸¸è§çš„æ¶‰ç¦½ï¼Œæ –æ¯åœ¨æ¹¿åœ°å’Œæ°´åŸŸè¾¹ç¼˜ï¼Œä»¥é±¼ç±»å’Œæ˜†è™«ä¸ºé£Ÿã€‚',
                'image': 'images/little_egret.jpg',
                'sound': 'sounds/little_egret.wav'
            },
            'å°ç™½è…°é›¨ç‡•': {
                'description': 'å°ç™½è…°é›¨ç‡•æ˜¯ä¸€ç§é«˜é€Ÿé£è¡Œçš„é¸Ÿç±»ï¼Œä»¥æ˜†è™«ä¸ºé£Ÿï¼Œå¸¸è§äºç©ºä¸­æ»‘ç¿”ã€‚',
                'image': 'images/swift.jpg',
                'sound': 'sounds/swift.wav'
            }
        };

        let gameData = null;
        let selectedSound = null;
        let selectedBird = null;
        let currentAudio = null;
        let currentGameBirds = [];
        let score = 0;
        let matches = 0;

        // ä»å®Œæ•´æ•°æ®ä¸­éšæœºé€‰æ‹©6ä¸ªé¸Ÿç±»
        function getRandomBirds(count = 6) {
            const allBirdNames = Object.keys(BIRD_GAME_DATA);
            const shuffled = allBirdNames.sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }

        // æ¸¸æˆæ§åˆ¶
        document.getElementById('startBtn').addEventListener('click', startNewGame);
        document.getElementById('resetBtn').addEventListener('click', resetGame);

        async function startNewGame() {
            try {
                showLoading(true);
                hideError();

                // éšæœºé€‰æ‹©6ä¸ªé¸Ÿç±»
                const selectedBirdNames = getRandomBirds(6);
                currentGameBirds = selectedBirdNames.map(name => ({
                    name: name,
                    ...BIRD_GAME_DATA[name]
                }));

                // æ¨¡æ‹ŸAPIå“åº”æ ¼å¼
                gameData = {
                    birds: currentGameBirds
                };

                score = 0;
                matches = 0;

                setupGame();
                document.getElementById('startBtn').disabled = true;
                document.getElementById('resetBtn').disabled = false;

            } catch (error) {
                showError('å¼€å§‹æ¸¸æˆå¤±è´¥: ' + error.message);
            }
        }

        function setupGame() {
            showLoading(false);
            document.getElementById('gameArea').classList.add('active');
            document.getElementById('gameResult').classList.remove('show');

            const soundsList = document.getElementById('soundsList');
            const birdsList = document.getElementById('birdsList');

            // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
            soundsList.innerHTML = '';
            birdsList.innerHTML = '';

            // åˆ›å»ºéŸ³é¢‘åˆ—è¡¨
            gameData.birds.forEach((bird, index) => {
                const soundItem = createSoundItem(bird, index);
                soundsList.appendChild(soundItem);
            });

            // åˆ›å»ºé¸Ÿç±»å›¾ç‰‡åˆ—è¡¨ï¼ˆéšæœºæ‰“ä¹±é¡ºåºï¼‰
            const shuffledBirds = [...gameData.birds].sort(() => Math.random() - 0.5);
            shuffledBirds.forEach((bird, index) => {
                const birdItem = createBirdItem(bird, index);
                birdsList.appendChild(birdItem);
            });

            // æ›´æ–°å¾—åˆ†æ˜¾ç¤º
            updateScore();
        }

        function createSoundItem(bird, index) {
            const soundItem = document.createElement('div');
            soundItem.className = 'sound-item';
            soundItem.dataset.sound = bird.name; // ä½¿ç”¨é¸Ÿåä½œä¸ºæ ‡è¯†
            soundItem.innerHTML = `
                <button class="play-btn" onclick="playSound('${bird.sound}')">â–¶</button>
                <div>é¸Ÿé¸£ ${index + 1}</div>
            `;

            soundItem.addEventListener('click', function() {
                if (!this.classList.contains('matched')) {
                    selectSound(this);
                }
            });

            return soundItem;
        }

        function createBirdItem(bird, index) {
            const birdItem = document.createElement('div');
            birdItem.className = 'bird-item';
            birdItem.dataset.bird = bird.name;
            birdItem.innerHTML = `
                <img src="/static/${bird.image}" alt="${bird.name}" class="bird-image"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                     onload="this.nextElementSibling.style.display='none'; this.style.display='block';">
                <div style="display:flex; width:80px; height:80px; background:rgba(227, 242, 253, 0.8); border-radius:10px; align-items:center; justify-content:center; font-size:10px; color:#666; text-align:center; flex-direction:column;">
                    <div style="font-size:20px; margin-bottom:4px;">ğŸ¦</div>
                    <div>å›¾ç‰‡åŠ è½½ä¸­...</div>
                </div>
                <div class="bird-name">${bird.name}</div>
            `;

            birdItem.addEventListener('click', function() {
                if (!this.classList.contains('matched')) {
                    selectBird(this);
                }
            });

            return birdItem;
        }

        function playSound(soundFile) {
            if (currentAudio) {
                currentAudio.pause();
            }

            currentAudio = new Audio(`/static/${soundFile}`);
            currentAudio.play().catch(error => {
                console.error('æ’­æ”¾éŸ³é¢‘å¤±è´¥:', error);
                showError('æ’­æ”¾éŸ³é¢‘å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„');
            });
        }

        function selectSound(element) {
            // ç§»é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.sound-item.selected').forEach(item => {
                item.classList.remove('selected');
            });

            element.classList.add('selected');
            selectedSound = element.dataset.sound;

            // å¦‚æœå·²é€‰æ‹©é¸Ÿç±»ï¼Œå°è¯•åŒ¹é…
            if (selectedBird) {
                checkMatch();
            }
        }

        function selectBird(element) {
            // ç§»é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.bird-item.selected').forEach(item => {
                item.classList.remove('selected');
            });

            element.classList.add('selected');
            selectedBird = element.dataset.bird;

            // å¦‚æœå·²é€‰æ‹©éŸ³é¢‘ï¼Œå°è¯•åŒ¹é…
            if (selectedSound) {
                checkMatch();
            }
        }

        async function checkMatch() {
            try {
                // æœ¬åœ°æ£€æŸ¥åŒ¹é…
                const isCorrect = selectedSound === selectedBird;

                const soundElement = document.querySelector(`[data-sound="${selectedSound}"]`);
                const birdElement = document.querySelector(`[data-bird="${selectedBird}"]`);

                if (isCorrect) {
                    // æ­£ç¡®åŒ¹é…
                    soundElement.classList.add('matched');
                    birdElement.classList.add('matched');
                    soundElement.classList.remove('selected');
                    birdElement.classList.remove('selected');

                    score += 10;
                    matches += 1;

                    // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
                    playSuccessSound();

                    // æ£€æŸ¥æ˜¯å¦å®Œæˆæ¸¸æˆ
                    if (matches === gameData.birds.length) {
                        setTimeout(() => {
                            showSuccessModal();
                        }, 500);
                    }

                } else {
                    // é”™è¯¯åŒ¹é…
                    soundElement.classList.add('wrong');
                    birdElement.classList.add('wrong');

                    // ç§»é™¤é”™è¯¯æ ·å¼
                    setTimeout(() => {
                        soundElement.classList.remove('wrong', 'selected');
                        birdElement.classList.remove('wrong', 'selected');
                    }, 1000);

                    // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                    playErrorSound();
                }

                // é‡ç½®é€‰æ‹©
                selectedSound = null;
                selectedBird = null;

                // æ›´æ–°å¾—åˆ†
                updateScore();

            } catch (error) {
                showError('åŒ¹é…æ£€æŸ¥å¤±è´¥: ' + error.message);
            }
        }

        function showSuccessModal() {
            const modal = document.getElementById('successModal');
            modal.classList.add('show');
        }

        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            modal.classList.remove('show');
        }

        function playSuccessSound() {
            // åˆ›å»ºç®€å•çš„æˆåŠŸæç¤ºéŸ³
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5

            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function playErrorSound() {
            // åˆ›å»ºç®€å•çš„é”™è¯¯æç¤ºéŸ³
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.2);

            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.4);
        }

        async function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('matches').textContent = `${matches}/${gameData.birds.length}`;
        }

        function showGameResult(finalScore) {
            document.getElementById('finalScore').textContent = `æœ€ç»ˆå¾—åˆ†: ${finalScore} åˆ†`;
            document.getElementById('gameResult').classList.add('show');
        }

        async function resetGame() {
            try {
                // é‡ç½®UI
                document.getElementById('gameArea').classList.remove('active');
                document.getElementById('startBtn').disabled = false;
                document.getElementById('resetBtn').disabled = true;
                document.getElementById('score').textContent = '0';
                document.getElementById('matches').textContent = '0/0';

                // åœæ­¢å½“å‰æ’­æ”¾çš„éŸ³é¢‘
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }

                // é‡ç½®é€‰æ‹©
                selectedSound = null;
                selectedBird = null;
                score = 0;
                matches = 0;
                currentGameBirds = [];

                // å…³é—­æˆåŠŸå¼¹çª—
                closeSuccessModal();

            } catch (error) {
                showError('é‡ç½®æ¸¸æˆå¤±è´¥: ' + error.message);
            }
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            const gameContent = document.getElementById('gameContent');

            if (show) {
                loading.style.display = 'block';
                gameContent.style.display = 'none';
            } else {
                loading.style.display = 'none';
                gameContent.style.display = 'grid';
            }
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';

            // 5ç§’åè‡ªåŠ¨éšè—
            setTimeout(hideError, 5000);
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¸Ÿé¸£è¿çº¿æ¸¸æˆå·²åŠ è½½');
        });

        // ç‚¹å‡»å¼¹çª—èƒŒæ™¯å…³é—­å¼¹çª—
        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSuccessModal();
            }
        });
    </script>
</body>
</html>